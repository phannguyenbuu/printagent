{% extends "base.html" %}

{% block content %}
<section class="panel">
  <div class="panel-head">
    <h3>ENV Runtime Config</h3>
    <span>Effective values with DB overrides</span>
  </div>
  <div id="env-config-grid" class="env-grid">
    <div class="hint">Loading...</div>
  </div>
  <form id="env-override-form" class="settings-grid">
    <label>API URL
      <input name="API_URL" placeholder="http://localhost:8080/api" />
    </label>
    <label>User Token
      <input name="USER_TOKEN" placeholder="token" />
    </label>
    <label>Database URL
      <input name="DATABASE_URL" placeholder="sqlite:///storage/data/agent_config.db" />
    </label>
    <label>WS URL
      <input name="WS_URL" placeholder="ws://host/ws" />
    </label>
    <label>WS Auto Connect
      <input name="WS_AUTO_CONNECT" placeholder="true/false" />
    </label>
    <label>Webhook Mode
      <input name="WEBHOOK_MODE" placeholder="listen" />
    </label>
    <label>Webhook Listen Path
      <input name="WEBHOOK_LISTEN_PATH" placeholder="/api/update/receive-text" />
    </label>
    <label>Test IP
      <input name="TEST_IP" placeholder="192.168.1.228" />
    </label>
    <label>Test User
      <input name="TEST_USER" placeholder="admin" />
    </label>
    <label>Test Password
      <input name="TEST_PASSWORD" placeholder="password" />
    </label>
    <label>Polling Enabled
      <input name="POLLING_ENABLED" placeholder="true/false" />
    </label>
    <label>Polling URL
      <input name="POLLING_URL" placeholder="http://vps:8000/api/polling" />
    </label>
    <label>Polling Lead
      <input name="POLLING_LEAD" placeholder="default" />
    </label>
    <label>Polling Token
      <input name="POLLING_TOKEN" placeholder="change-me" />
    </label>
    <label>Polling Interval Seconds
      <input name="POLLING_INTERVAL_SECONDS" placeholder="60" />
    </label>
    <div>
      <button type="submit" class="btn ghost">Save ENV Overrides (DB)</button>
    </div>
  </form>
</section>

<section class="panel">
  <div class="panel-head">
    <h3>Device Filters</h3>
    <span>Show all printers or only valid printers (name not starting with blocked prefixes)</span>
  </div>
  <form id="device-filter-form" class="settings-grid">
    <label>Filter Mode
      <select name="filter_mode">
        <option value="all">All printers</option>
        <option value="valid_only">Valid only</option>
      </select>
    </label>
    <label>Ignored Prefixes
      <input name="ignore_printer_prefixes" placeholder="RustDesk,RuskDesk,Microsoft,Fax,AnyDesk,Foxit" />
    </label>
    <div>
      <button type="submit" class="btn ghost">Save Device Filters</button>
    </div>
  </form>
</section>

<section class="panel">
  <div class="panel-head">
    <h3>Network Printer Profile</h3>
    <span>Default config for network printers</span>
  </div>
  <form id="network-config-form" class="settings-grid">
    <label>Subnet Mask
      <input name="subnet_mask" placeholder="255.255.255.0" />
    </label>
    <label>Gateway
      <input name="gateway" placeholder="192.168.1.1" />
    </label>
    <label>DNS Primary
      <input name="dns_primary" placeholder="8.8.8.8" />
    </label>
    <label>DNS Secondary
      <input name="dns_secondary" placeholder="1.1.1.1" />
    </label>
    <label>SNMP Community
      <input name="snmp_community" placeholder="public" />
    </label>
    <label>SNMP Port
      <input type="number" name="snmp_port" placeholder="161" />
    </label>
    <label>Timeout (seconds)
      <input type="number" name="timeout_seconds" placeholder="10" />
    </label>
    <div>
      <button type="submit" class="btn ghost">Save Network Config</button>
    </div>
  </form>
</section>

<section class="panel-grid dashboard-config-grid">
  <article class="panel">
    <div class="panel-head">
      <h3>Computers</h3>
      <span>Clients using shared printers</span>
    </div>
    <form id="computer-form" class="inline-form">
      <input name="name" placeholder="Computer name" required />
      <input name="ip" placeholder="IP address" />
      <input name="department" placeholder="Department" />
      <button type="submit" class="btn ghost">Add Computer</button>
    </form>
    <div class="table-wrap">
      <table class="device-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>IP</th>
            <th>Department</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="computers-body">
          <tr><td colspan="4">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </article>
  <article class="panel">
    <div class="panel-head">
      <h3>Printers</h3>
      <span>Network printer inventory</span>
    </div>
    <form id="printer-form" class="inline-form">
      <input name="name" placeholder="Printer name" required />
      <input name="ip" placeholder="IP address" />
      <input name="model" placeholder="Model" />
      <input name="location" placeholder="Location" />
      <button type="submit" class="btn ghost">Add Printer</button>
    </form>
    <div class="table-wrap">
      <table class="device-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>IP</th>
            <th>Model</th>
            <th>Location</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="printers-body">
          <tr><td colspan="5">Loading...</td></tr>
        </tbody>
      </table>
    </div>
  </article>
</section>

<section class="panel">
  <div class="panel-head">
    <h3>Computer x Printer Mapping</h3>
    <span>Many-to-many cross links</span>
  </div>
  <div class="table-wrap">
    <table id="link-matrix" class="device-table">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>
  <div class="mapping-actions">
    <button id="save-links-btn" class="btn ghost">Save Mapping</button>
  </div>
  <pre id="dashboard-config-output" class="json-output"></pre>
</section>
{% endblock %}
